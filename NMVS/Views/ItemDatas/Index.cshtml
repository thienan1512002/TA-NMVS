@{
    ViewData["Title"] = "Item Datas";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-12">
        <div class="table-responsive">
            <table class="table table-striped table-info " id="tbl_item_data">
                <thead>
                    <tr>
                        <td>Item No</td>
                        <td>Item Name</td>
                        <td>Item Type</td>
                        <td>Item unit package</td>
                        <td>Item quantity (in 1 package)</td>
                        <td>Item package</td>
                        <td>Item wh (for 1 unit)</td>
                        <td>Status</td>
                        <td>Flanable</td>
                        <td>Action</td>
                    </tr>
                </thead>
            </table>
        </div>
        <br />
        <a asp-action="Create" class="btn btn-primary">Create new</a>
        <input type="file" class="btn btn-primary" id="btnExport" />
    </div>
</div>
<script src="~/lib/jquery/dist/jquery.min.js"></script>

<script>
    $(document).ready(function () {
        $('#tbl_item_data').DataTable({
            "ajax": {
                "url": "/ItemDatas/GetItemData",
                "dataSrc": ""
            },
            "columns": [
                { "data": "ItemNo" },
                { "data": "ItemName" },
                { "data": "ItemType" },
                { "data": "ItemUm" },
                { "data": "ItemPkgQty" },
                { "data": "ItemPkg" },
                { "data": "ItemWhUnit" },
                {
                    "data": "Active", "render": (data) => {
                        const button = data ? `<span class="badge badge-danger">Inactive</span>` : `<span class="badge badge-success">Active</span>`;
                        return button;
                    }
                },
                {
                    "data": "Flammable", "render": (data) => {
                        const content = data ? `<span class="badge badge-danger">Flammable</span>` : `<span class="badge badge-success">Not flamable</span>`;
                        return content;

                    }
                },
                {
                    "data": "Id", "render": (data) => {
                        const content = `<a href="/ItemDatas/Edit/${data}" class="btn btn-primary">Edit</a>`;
                        return content;
                    }
                }

            ]
        });
    });
    if (document.getElementById("btnExport") != null) {
        const file = document.getElementById("btnExport");
        file.addEventListener("change", () => {
            let itemsData = []
            const name = file.files[0].name
            readXlsxFile(file.files[0]).then((data) => {
                for (let i = 2; i < data.length; i++) {
                    const objects = { itemNo: data[i][0], itemName: data[i][1], itemType: data[i][2], itemUm: data[i][3], itemPkgQty: data[i][4], itemPkg: data[i][5], itemWhUnit: data[i][6], active: data[i][7], flamable: data[i][8] };
                    itemsData.push(objects);
                    //console.log(objects);
                }
                $.ajax({
                    url: "ItemDatas/CreateByExcel",
                    method: "POST",
                    data: { items: itemsData, name: name },
                    success: (data) => {
                        $("#tbl_item_data").DataTable().ajax.reload();
                    }
                })
                console.log(itemsData);
            });

        })
    }
</script>
