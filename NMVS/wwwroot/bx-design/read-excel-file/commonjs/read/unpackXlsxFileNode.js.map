{"version":3,"sources":["../../source/read/unpackXlsxFileNode.js"],"names":["unpackXlsxFile","input","entries","stream","Stream","fs","createReadStream","Promise","resolve","reject","entryPromises","on","pipe","unzip","Parse","all","then","entry","contents","push","data","toString","path"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;AAEA;AACA;AACA;AACA;AACA;AACe,SAASA,cAAT,CAAwBC,KAAxB,EAA+B;AAC5C;AACA;AACA;AACA,MAAMC,OAAO,GAAG,EAAhB;AAEA,MAAMC,MAAM,GAAGF,KAAK,YAAYG,kBAAjB,GAA0BH,KAA1B,GAAkCI,eAAGC,gBAAH,CAAoBL,KAApB,CAAjD;AAEA,SAAO,IAAIM,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,QAAMC,aAAa,GAAG,EAAtB;AAEAP,IAAAA,MAAM,CACJ;AADI,KAEHQ,EAFH,CAEM,OAFN,EAEeF,MAFf,EAGGG,IAHH,CAGQC,qBAAMC,KAAN,EAHR,EAIE;AAJF,KAKGH,EALH,CAKM,OALN,EAKeF,MALf,EAMGE,EANH,CAMM,OANN,EAMe;AAAA,aAAOJ,OAAO,CAACQ,GAAR,CAAYL,aAAZ,EAA2BM,IAA3B,CAAgC;AAAA,eAAMR,OAAO,CAACN,OAAD,CAAb;AAAA,OAAhC,CAAP;AAAA,KANf,EAOGS,EAPH,CAOM,OAPN,EAOe,UAACM,KAAD,EAAW;AACtB,UAAIC,QAAQ,GAAG,EAAf,CADsB,CAEtB;;AACAR,MAAAA,aAAa,CAACS,IAAd,CAAmB,IAAIZ,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC1CS,QAAAA,KAAK,CACFN,EADH,CACM,MADN,EACc,UAAAS,IAAI;AAAA,iBAAIF,QAAQ,IAAIE,IAAI,CAACC,QAAL,EAAhB;AAAA,SADlB,EAEGV,EAFH,CAEM,KAFN,EAEa;AAAA,iBAAMH,OAAO,CAACN,OAAO,CAACe,KAAK,CAACK,IAAP,CAAP,GAAsBJ,QAAvB,CAAb;AAAA,SAFb;AAGD,OAJkB,CAAnB;AAKD,KAfH;AAgBD,GAnBM,CAAP;AAoBD","sourcesContent":["import fs from 'fs'\nimport Stream from 'stream'\nimport unzip from 'unzipper'\n\n/**\n * Reads XLSX file in Node.js.\n * @param  {(string|Stream)} input - A Node.js readable stream or a path to a file.\n * @return {Promise} Resolves to an object holding XLSX file entries.\n */\nexport default function unpackXlsxFile(input) {\n  // XLSX file is a zip archive.\n  // The `entries` object stores the files\n  // and their contents from this XLSX zip archive.\n  const entries = {}\n\n  const stream = input instanceof Stream ? input : fs.createReadStream(input)\n\n  return new Promise((resolve, reject) => {\n    const entryPromises = []\n\n    stream\n      // This first \"error\" listener is for the original stream errors.\n      .on('error', reject)\n      .pipe(unzip.Parse())\n      // This second \"error\" listener is for the unzip stream errors.\n      .on('error', reject)\n      .on('close', () =>  Promise.all(entryPromises).then(() => resolve(entries)))\n      .on('entry', (entry) => {\n        let contents = ''\n        // To ignore an entry: `entry.autodrain()`.\n        entryPromises.push(new Promise((resolve) => {\n          entry\n            .on('data', data => contents += data.toString())\n            .on('end', () => resolve(entries[entry.path] = contents))\n        }))\n      })\n  })\n}\n"],"file":"unpackXlsxFileNode.js"}